# PB-BI 测试大纲

## 版本信息
- 版本: 2.1
- 创建日期: 2026-02-14
- 最后更新: 2026-02-15
- 状态: 混合架构测试

## 1. 测试概述

### 1.1 测试目标
- 验证 PB-BI 软件功能符合需求分析
- 确保系统稳定性和可靠性
- 保证用户体验质量

### 1.2 测试范围
- 配置管理模块
- 数据获取模块
- 数据运算模块
- 数据可视化模块

### 1.3 测试策略
- 单元测试
- 集成测试
- 系统测试
- 用户验收测试

---

## 2. 测试环境

### 2.1 硬件环境
- CPU: 双核及以上
- 内存: 4GB 及以上
- 硬盘: 10GB 可用空间

### 2.2 软件环境
- 操作系统: Windows 10+ / macOS 10.15+ / Linux
- Python: 3.9+ (当前版本) / Java 17+ (重构后)
- Node.js: 16+
- Maven: 3.8+ (重构后)
- 浏览器: Chrome 90+ / Firefox 88+ / Safari 14+

### 2.3 重构测试环境
- JDK 17+
- Spring Boot 3.x
- Apache Calcite 1.36+
- Apache SeaTunnel 2.3+

---

## 3. 测试用例

### 3.1 配置管理模块测试用例

| 用例编号 | 用例名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|----------|----------|----------|----------|----------|--------|
| TC-CFG-001 | 创建数据流 | 系统已启动 | 1. 点击"增加数据流"<br>2. 输入名称、appkey、sign、工作表 ID<br>3. 点击保存 | 数据流创建成功 | 高 |
| TC-CFG-002 | 编辑数据流 | 已有数据流 | 1. 点击编辑按钮<br>2. 修改信息<br>3. 保存 | 更新成功 | 高 |
| TC-CFG-003 | 删除数据流 | 已有数据流 | 1. 点击删除按钮<br>2. 确认删除 | 数据流删除成功 | 高 |
| TC-CFG-004 | 连接测试 | 已配置正确参数 | 1. 点击测试按钮 | 连接成功提示 | 高 |
| TC-CFG-005 | 点击设置按钮 | 已有数据流 | 1. 点击设置按钮 | 显示字段列表 | 高 |
| TC-CFG-006 | 字段启用设置 | 已显示字段列表 | 1. 勾选/取消勾选字段<br>2. 点击保存配置 | 配置保存成功 | 高 |
| TC-CFG-007 | 字段类型设置 | 已显示字段列表 | 1. 修改字段类型<br>2. 点击保存配置 | 配置保存成功 | 高 |
| TC-CFG-008 | 空配置验证 | 未输入必填项 | 1. 点击保存 | 提示必填项 | 中 |

### 3.2 数据获取模块测试用例

| 用例编号 | 用例名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|----------|----------|----------|----------|----------|--------|
| TC-DATA-001 | 选择数据流 | 已有数据流 | 1. 进入数据页面<br>2. 点击一个数据流 | 数据流被选中，显示加载数据按钮 | 高 |
| TC-DATA-002 | 加载数据 | 已选择数据流 | 1. 点击"加载数据"按钮 | 显示该数据流的数据表格 | 高 |
| TC-DATA-003 | 仅显示启用字段 | 已配置字段启用设置 | 1. 加载数据 | 表格只显示在数据设置中启用的字段 | 高 |
| TC-DATA-004 | 数据格式显示 | 已加载数据 | 1. 查看表格数据 | 各种数据类型正确显示 | 中 |
| TC-DATA-005 | 无数据流提示 | 未创建数据流 | 1. 进入数据页面 | 显示"暂无数据流"提示 | 低 |

### 3.3 数据运算模块测试用例

| 用例编号 | 用例名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|----------|----------|----------|----------|----------|--------|
| TC-CALC-001 | 可视化加法运算 | 已有数据 | 1. 选择字段 A 和字段 B<br>2. 选择加法运算符<br>3. 执行计算 | 结果正确 | 高 |
| TC-CALC-002 | 自定义 Python 代码 | 已有数据 | 1. 输入简单 Python 代码<br>2. 执行 | 代码正确执行并返回结果 | 高 |
| TC-CALC-003 | 自定义代码安全限制 | 尝试危险操作 | 1. 输入包含 os 模块的代码<br>2. 执行 | 代码被拒绝执行 | 高 |
| TC-CALC-004 | 计算结果保存 | 计算完成 | 1. 点击保存结果 | 结果保存成功 | 中 |

### 3.4 数据可视化模块测试用例

| 用例编号 | 用例名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|----------|----------|----------|----------|----------|--------|
| TC-VIS-001 | 柱状图展示 | 已有数据 | 1. 选择柱状图类型<br>2. 选择 X/Y 轴字段<br>3. 生成图表 | 正确显示柱状图 | 高 |
| TC-VIS-002 | 折线图展示 | 已有数据 | 1. 选择折线图类型<br>2. 生成图表 | 正确显示折线图 | 高 |
| TC-VIS-003 | 饼图展示 | 已有数据 | 1. 选择饼图类型<br>2. 生成图表 | 正确显示饼图 | 中 |
| TC-VIS-004 | 图表导出 | 已生成图表 | 1. 点击导出<br>2. 选择格式 | 成功导出图片 | 中 |

### 3.5 混合架构测试用例（迭代 2.0 - 方案1）

| 用例编号 | 用例名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|----------|----------|----------|----------|----------|--------|
| TC-HYBRID-001 | Spring Boot 数据服务启动 | 项目已构建 | 1. 启动 Spring Boot 数据服务<br>2. 检查端口监听 | 应用成功启动，端口 8081 监听 | 高 |
| TC-HYBRID-002 | FastAPI 桥接层启动 | Spring Boot 已启动 | 1. 启动 FastAPI 服务<br>2. 检查 Spring Boot 连接 | FastAPI 成功启动，能连接到 Spring Boot | 高 |
| TC-HYBRID-003 | FastAPI → Spring Boot 健康检查 | 两个服务都已启动 | 1. 调用 FastAPI 内部健康检查接口<br>2. 验证 Spring Boot 状态 | 返回两个服务都健康 | 高 |
| TC-HYBRID-004 | Calcite 查询桥接 | 已有快照数据 | 1. 通过 FastAPI 调用 Calcite 查询<br>2. 验证返回结果 | 查询正确执行，结果正确返回 | 高 |
| TC-HYBRID-005 | SeaTunnel 同步桥接触发 | 已有数据流配置 | 1. 通过 FastAPI 触发 SeaTunnel 同步<br>2. 检查任务状态 | 同步任务成功触发 | 高 |
| TC-HYBRID-006 | SeaTunnel 同步状态查询 | 同步任务已触发 | 1. 通过 FastAPI 查询同步状态<br>2. 验证状态更新 | 状态正确返回并更新 | 高 |
| TC-HYBRID-007 | Calcite 明道云数据源查询 | 已配置明道云连接 | 1. 通过 FastAPI 桥接查询明道云数据<br>2. 验证数据完整性 | 数据正确返回，字段完整 | 高 |
| TC-HYBRID-008 | 桥接层错误处理 | Spring Boot 服务不可用 | 1. 停止 Spring Boot 服务<br>2. 调用桥接 API<br>3. 验证错误处理 | 返回友好的错误提示，FastAPI 不崩溃 | 高 |
| TC-HYBRID-009 | 桥接层超时处理 | Spring Boot 响应慢 | 1. 模拟 Spring Boot 超时<br>2. 调用桥接 API<br>3. 验证超时处理 | 触发超时机制，返回超时错误 | 中 |
| TC-HYBRID-010 | 桥接层重试机制 | 临时网络故障 | 1. 模拟临时网络故障<br>2. 调用桥接 API<br>3. 验证重试逻辑 | 自动重试，最终成功 | 中 |
| TC-HYBRID-011 | 双服务并行运行 | 两个服务都正常 | 1. 同时使用 FastAPI 原有功能和桥接功能<br>2. 验证互不干扰 | 两个功能都正常工作 | 高 |
| TC-HYBRID-012 | 回归测试 - 原有功能 | 混合架构 | 1. 执行 TC-CFG-001 到 TC-CFG-008<br>2. 执行 TC-DATA-001 到 TC-DATA-005 | 所有原有测试用例通过 | 高 |

### 3.6 架构重构测试用例（迭代 2.0 - 备用）

| 用例编号 | 用例名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|----------|----------|----------|----------|----------|--------|
| TC-REF-001 | Spring Boot 项目启动 | 项目已构建 | 1. 启动 Spring Boot 应用 | 应用成功启动，端口 8000 监听 | 高 |
| TC-REF-002 | JPA 数据库映射 | 数据库已创建 | 1. 检查数据表结构<br>2. 验证实体映射 | 所有表正确创建，映射关系正确 | 高 |
| TC-REF-003 | 配置管理 API 迁移 | 已有配置数据 | 1. 调用 GET /api/dataflows<br>2. 调用 POST /api/dataflows<br>3. 调用 PUT /api/dataflows/{id}<br>4. 调用 DELETE /api/dataflows/{id} | 所有 API 返回正确结果，与 FastAPI 版本行为一致 | 高 |
| TC-REF-004 | 数据处理 API 迁移 | 已有数据流 | 1. 调用 GET /api/data/{id}/fields<br>2. 调用 POST /api/data/query | API 返回正确数据 | 高 |
| TC-REF-005 | Apache Calcite 集成 | Calcite 已配置 | 1. 执行简单 SQL 查询<br>2. 执行多表联合查询 | 查询正确执行并返回结果 | 高 |
| TC-REF-006 | 明道云数据源查询 | 已配置明道云连接 | 1. 通过 Calcite 查询明道云数据 | 数据正确返回 | 高 |
| TC-REF-007 | 快照数据源查询 | 已有快照数据 | 1. 通过 Calcite 查询快照数据 | 数据正确返回 | 高 |
| TC-REF-008 | Apache SeaTunnel 数据同步 | SeaTunnel 已配置 | 1. 触发数据同步作业<br>2. 检查目标数据库 | 数据成功同步到本地数据库 | 高 |
| TC-REF-009 | 增量数据同步 | 明道云有新数据 | 1. 触发增量同步<br>2. 验证新数据 | 新数据正确同步 | 中 |
| TC-REF-010 | 前后端联调 | 前后端都已启动 | 1. 前端调用所有 API<br>2. 验证数据展示 | 前端页面正常显示，功能完整 | 高 |
| TC-REF-011 | 回归测试 - 配置管理 | Spring Boot 版本 | 1. 执行 TC-CFG-001 到 TC-CFG-008 | 所有测试用例通过 | 高 |
| TC-REF-012 | 回归测试 - 数据获取 | Spring Boot 版本 | 1. 执行 TC-DATA-001 到 TC-DATA-005 | 所有测试用例通过 | 高 |

### 3.7 性能测试用例

| 用例编号 | 用例名称 | 前置条件 | 测试步骤 | 预期结果 | 优先级 |
|----------|----------|----------|----------|----------|--------|
| TC-PERF-001 | 数据读取响应时间 | 1000 条数据 | 1. 查询数据<br>2. 计时 | 响应时间 < 5 秒 | 中 |
| TC-PERF-002 | 图表渲染时间 | 1000 条数据 | 1. 生成图表<br>2. 计时 | 渲染时间 < 3 秒 | 中 |
| TC-PERF-003 | Calcite 查询性能 | 10000 条数据 | 1. 执行复杂 SQL 查询<br>2. 计时 | 查询时间 < 10 秒 | 中 |
| TC-PERF-004 | SeaTunnel 同步性能 | 10000 条数据 | 1. 执行全量同步<br>2. 计时 | 同步时间 < 30 秒 | 中 |

---

## 4. 测试进度计划

| 测试阶段 | 开始时间 | 结束时间 | 负责人 |
|----------|----------|----------|--------|
| 迭代 1 配置管理测试 | 迭代 1 结束后 | 迭代 1 结束后 2 天 | 测试人员 |
| 迭代 1.1 字段配置测试 | 迭代 1.1 结束后 | 迭代 1.1 结束后 1 天 | 测试人员 |
| 迭代 1.2 数据同步测试 | 迭代 1.2 结束后 | 迭代 1.2 结束后 1 天 | 测试人员 |
| 迭代 2.0 架构重构测试 | 迭代 2.0 中期 | 迭代 2.0 中期 5 天 | 测试人员 |
| 数据运算模块测试 | 迭代 3 结束后 | 迭代 3 结束后 2 天 | 测试人员 |
| 数据可视化模块测试 | 迭代 4 结束后 | 迭代 4 结束后 2 天 | 测试人员 |
| 集成测试 | 迭代 5 中期 | 迭代 5 中期 3 天 | 测试人员 |
| 验收测试 | 迭代 5 末期 | 迭代 5 末期 2 天 | 测试人员 + 项目经理 |

### 迭代 2.0 测试里程碑（混合架构 - 方案1）
- [ ] 阶段 1 测试：Spring Boot 数据服务（TC-HYBRID-001）
- [ ] 阶段 2 测试：FastAPI 桥接层（TC-HYBRID-002 ~ TC-HYBRID-003）
- [ ] 阶段 3 测试：Calcite 查询桥接（TC-HYBRID-004 ~ TC-HYBRID-007）
- [ ] 阶段 4 测试：SeaTunnel 同步桥接（TC-HYBRID-005 ~ TC-HYBRID-006）
- [ ] 容错性测试（TC-HYBRID-008 ~ TC-HYBRID-010）
- [ ] 回归测试（TC-HYBRID-011 ~ TC-HYBRID-012）
- [ ] 性能测试（TC-PERF-001 ~ TC-PERF-004）

### 迭代 2.0 测试里程碑（备用 - 完全重构）
- [ ] Spring Boot 基础框架测试（TC-REF-001 ~ TC-REF-004）
- [ ] Apache Calcite 集成测试（TC-REF-005 ~ TC-REF-007）
- [ ] Apache SeaTunnel 集成测试（TC-REF-008 ~ TC-REF-009）
- [ ] 前后端联调测试（TC-REF-010）
- [ ] 回归测试（TC-REF-011 ~ TC-REF-012）
- [ ] 性能测试（TC-PERF-003 ~ TC-PERF-004）

---

**变更记录**
| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|----------|
| 1.0 | 2026-02-14 | 测试人员 | 初始版本创建 |
| 1.1 | 2026-02-14 | 测试人员 | 更新配置管理模块测试用例，添加字段配置相关测试用例 |
| 1.2 | 2026-02-15 | 测试人员 | 更新数据获取模块测试用例，添加数据同步和展示相关测试用例 |
| 2.0 | 2026-02-15 | 测试人员 | 添加架构重构测试用例（Spring Boot + Calcite + SeaTunnel） |
| 2.1 | 2026-02-15 | 测试人员 | 添加混合架构测试用例（FastAPI + Spring Boot 桥接） |
